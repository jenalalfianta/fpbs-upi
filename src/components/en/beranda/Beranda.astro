---
import { getCollection } from 'astro:content';
import slugify from 'slugify';

const fixHtml = (url) => url.replace(/\/$/, '') + '/index.html';

const berita = (await getCollection('berita'))
  .filter(item => item.data.lang === 'en')
  .sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate))
  .slice(0, 6);
---
<section class="bg-gray-50 dark:bg-gray-800 m-0 p-0">
  <style>
    .carousel-wrapper {
      height: clamp(220px, 60vw, 760px);
      padding: 0 !important;
      margin: 0 !important;
    }
    @media (min-width: 768px) {
      .carousel-wrapper {
        height: clamp(420px, 55vw, 760px);
      }
    }
    .carousel-slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 0.7s ease-in-out;
      pointer-events: none;
    }
    .carousel-slide.active {
      opacity: 1;
      pointer-events: auto;
    }
    .carousel-wrapper img {
      object-fit: contain;
      object-position: top;
      width: 100%;
      height: 100%;
    }
    .carousel-wrapper:hover .carousel-arrow {
      opacity: 1;
    }
    .carousel-arrow {
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .carousel-arrow span {
      background-color: rgba(0, 0, 0, 0.35);
    }
    @media (max-width: 767px) {
      .carousel-arrow {
        opacity: 0;
        pointer-events: none;
      }
    }
  </style>

  <div class="relative w-full carousel-wrapper overflow-hidden bg-gray-50 dark:bg-gray-800 m-0 p-0">
    <div class="carousel-slide active">
      <img src="/images/beranda/zi.webp" class="w-full h-full" alt="Slide ZI" />
    </div>

    <button type="button" class="carousel-arrow absolute top-0 left-0 z-20 flex items-center justify-center h-full px-4 group focus:outline-none" data-action="prev">
      <span class="inline-flex items-center justify-center w-10 h-10 rounded-full">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </span>
    </button>
    <button type="button" class="carousel-arrow absolute top-0 right-0 z-20 flex items-center justify-center h-full px-4 group focus:outline-none" data-action="next">
      <span class="inline-flex items-center justify-center w-10 h-10 rounded-full">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 5 7 7-7 7" />
        </svg>
      </span>
    </button>

    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 z-20" data-dots></div>
  </div>

  <script>
    (() => {
      const root = document.currentScript?.previousElementSibling;
      if (!root) return;

      const slides = root.querySelectorAll('.carousel-slide');
      const dotsContainer = root.querySelector('[data-dots]');
      const btnPrev = root.querySelector('[data-action="prev"]');
      const btnNext = root.querySelector('[data-action="next"]');
      const intervalMs = 8000;
      if (!slides.length || !dotsContainer) return;

      let current = 0;
      let timer;
      let touchStartX = 0;
      let isSwiping = false;

      function renderDots() {
        dotsContainer.innerHTML = '';
        slides.forEach((_, i) => {
          const dot = document.createElement('button');
          dot.type = 'button';
          dot.className = 'w-3 h-3 rounded-full ' + (i === 0 ? 'bg-white' : 'bg-gray-400/70');
          dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
          dot.addEventListener('click', () => showSlide(i, true));
          dotsContainer.appendChild(dot);
        });
      }

      function updateDots() {
        Array.from(dotsContainer.children).forEach((dot, i) => {
          dot.classList.toggle('bg-white', i === current);
          dot.classList.toggle('bg-gray-400/70', i !== current);
        });
      }

      function showSlide(index, resetTimer = false) {
        slides.forEach((slide, i) => {
          slide.classList.toggle('active', i === index);
        });
        current = index;
        updateDots();
        if (resetTimer) restartAuto();
      }

      function nextSlide() {
        showSlide((current + 1) % slides.length);
      }

      function prevSlide() {
        showSlide((current - 1 + slides.length) % slides.length);
      }

      function startAuto() {
        stopAuto();
        timer = setInterval(nextSlide, intervalMs);
      }

      function stopAuto() {
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
      }

      function restartAuto() {
        stopAuto();
        startAuto();
      }

      btnPrev?.addEventListener('click', () => {
        prevSlide();
        restartAuto();
      });
      btnNext?.addEventListener('click', () => {
        nextSlide();
        restartAuto();
      });

      root.addEventListener('mouseenter', stopAuto);
      root.addEventListener('mouseleave', startAuto);

      root.addEventListener('touchstart', (event) => {
        if (!event.touches.length) return;
        touchStartX = event.touches[0].clientX;
        isSwiping = true;
        stopAuto();
      }, { passive: true });

      root.addEventListener('touchmove', (event) => {
        if (!isSwiping || !event.touches.length) return;
        const deltaX = event.touches[0].clientX - touchStartX;
        if (Math.abs(deltaX) > 40) {
          isSwiping = false;
          if (deltaX > 0) {
            prevSlide();
          } else {
            nextSlide();
          }
          restartAuto();
        }
      }, { passive: true });

      root.addEventListener('touchend', () => {
        isSwiping = false;
        startAuto();
      });

      renderDots();
      updateDots();
      showSlide(0);
      startAuto();
    })();
  </script>
</section>

<section class="bg-gray-50 dark:bg-gray-800 py-8 md:py-16 px-4 md:px-8">
  <div class="max-w-screen-xl mx-auto flex flex-col md:flex-row md:items-center gap-12">
    
    <div class="w-full md:w-2/3 text-gray-800 dark:text-gray-100 h-full flex flex-col justify-center">
      <h2 class="text-2xl font-bold text-purple-700 dark:text-purple-400 mb-4 uppercase">
        Dean's Welcome
      </h2>
      <p class="text-justify text-base md:text-lg leading-relaxed mb-4">
        Welcome to the website of the Faculty of Language and Literature Education, Universitas Pendidikan Indonesia. We are committed to providing language and literature education services that play an important role in helping students develop critical thinking, self-expression, and a deeper understanding of language and literature.
      </p>
    </div>
    
    <div class="w-full md:w-auto flex flex-col items-center text-center">
      <img
        src="/images/beranda/dekanfpbs.webp"
        alt="Wawan Gunawan, M.Ed., Ph.D."
        class="rounded-lg shadow-md object-cover w-full md:w-[340px]"
      />
      <p class="font-semibold mt-4 text-purple-700 dark:text-purple-400 text-base md:text-lg">
        Wawan Gunawan, M.Ed., Ph.D.
      </p>
    </div>
  </div>
</section>

<section class="bg-gray-50 dark:bg-gray-800 py-8 md:py-16 px-4 md:px-8 block md:hidden">
  <div class="max-w-screen-xl mx-auto flex flex-col gap-6">
    
    <div class="text-gray-800 dark:text-gray-100">
      <h2 class="text-2xl font-bold text-purple-700 dark:text-purple-400 mb-4 uppercase">About FPBS</h2>
      <p class="text-justify text-base leading-relaxed">
        In 1963, FKIP and the Teacher Education Institute (under the Ministry of Education) were merged into the Institute of Teacher Training and Education (IKIP), and the Faculty of Language and Arts Education (FKSS) de facto became one of its faculties. However, FKSS was officially recognized in 1964 through Instruction of the Minister of Higher Education and Science No. 128 of 1964, which included 4 departments and 2 sections.
      </p>
    </div>
    
    <div class="aspect-video rounded-lg overflow-hidden shadow-md">
      <iframe 
        class="w-full h-full"
        src="https://www.youtube.com/embed/et3smxctl-U?si=1hg3xOV99Dcqnppl"
        title="About FPBS"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen
      ></iframe>
    </div>
    
    <div class="text-right">
      <a href="/en/profile/about/index.html" class="inline-block text-sm font-medium text-purple-700 dark:text-purple-400 hover:underline">Read more »</a>
    </div>
  </div>
</section>

<section class="bg-gray-50 dark:bg-gray-800 py-8 md:py-16 px-4 md:px-8 hidden md:flex">
  <div class="max-w-screen-xl mx-auto flex flex-row items-center gap-10">
    
    <div class="w-1/2 aspect-video rounded-lg overflow-hidden shadow-md">
      <iframe 
        class="w-full h-full"
        src="https://www.youtube.com/embed/et3smxctl-U?si=1hg3xOV99Dcqnppl"
        title="About FPBS"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen
      ></iframe>
    </div>
    
    <div class="w-1/2 text-gray-800 dark:text-gray-100">
      <h2 class="text-2xl font-bold text-purple-700 dark:text-purple-400 mb-4 uppercase">About FPBS</h2>
      <p class="text-justify text-base md:text-lg leading-relaxed mb-6">
        In 1963, FKIP and the Teacher Education Institute (under the Ministry of Education) were merged into the Institute of Teacher Training and Education (IKIP), and the Faculty of Language and Arts Education (FKSS) de facto became one of its faculties. However, FKSS was officially recognized in 1964 through Instruction of the Minister of Higher Education and Science No. 128 of 1964, which included 4 departments and 2 sections.
      </p>
      <a href="/en/profile/about/index.html" class="inline-block text-sm font-medium text-purple-700 dark:text-purple-400 hover:underline">Read more »</a>
    </div>
  </div>
</section>

<section class="bg-gray-50 dark:bg-gray-800 py-8 md:py-16 px-4 md:px-8">
  <div class="max-w-screen-xl mx-auto">
    <h2 class="text-2xl font-bold text-purple-700 dark:text-purple-400 mb-8 uppercase">Latest News</h2>
    <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-3">
      {berita.map(item => {
        const url = fixHtml(`/en/news/${slugify(item.data.title, { lower: true, strict: true })}`);

        const tampilTanggal = new Date(item.data.pubDate).toLocaleDateString('en-GB', {
          day: 'numeric',
          month: 'long',
          year: 'numeric'
        });

        return (
          <article class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col h-full">
            {item.data.image && (
              <a href={url}>
                <img src={item.data.image.url} alt={item.data.image.alt} class="w-full h-56 object-cover" />
              </a>
            )}
            <div class="px-5 pt-6 pb-8 flex flex-col flex-1">
              <div class="flex justify-between items-center mb-4">
                <span class="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-purple-900 dark:text-purple-200">
                  {item.data.tags?.[0] ?? 'News'}
                </span>
                <span class="text-sm text-gray-500 dark:text-gray-400">{tampilTanggal}</span>
              </div>
              <h3 class="text-base font-semibold text-gray-900 dark:text-white leading-tight mb-4">
                <a href={url}>{item.data.title}</a>
              </h3>
              <div class="mt-auto text-right">
                <a href={url} class="text-sm font-medium text-purple-700 dark:text-purple-400 hover:underline">Read more →</a>
              </div>
            </div>
          </article>
        );
      })}
    </div>
    <div class="text-center mt-8">
      <a href={fixHtml("/en/news/page/1")} class="inline-block text-sm font-medium text-purple-700 dark:text-purple-400 hover:underline">See All News »</a>
    </div>
  </div>
</section>
